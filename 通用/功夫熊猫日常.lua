--[[ 奇穴: [扬戈][神勇][大漠][击水 or 龙驭][驰骋][牧云][风虎][战心][渊][夜征][龙血][虎贲]
秘籍:
穿云  1调息 1会心 2伤害
龙吟  1调息 3伤害
龙牙  1会心 3伤害
突    1消耗 1距离 2伤害
灭    1调息 1会心 2伤害
战八方 1目标个数 1范围 2伤害
断魂刺 2调息 2伤害

如果点了[龙驭], 上马之后龙驭不到3层就动起来, 到3层站桩打
--]]
load("Macro/Lib_PVP.lua")
load("Macro/Lib_Base.lua")
load("Macro/Lib_Tools.lua")
--变量表
local v = {}
local f = {}

local task2 = {
    { 23634, 29804, 1317504 },
    { 23634, 29804, 1317504 },
    { 23634, 29804, 1317504 },
    { 23634, 29804, 1317504 },
    { 23634, 29804, 1317504 },
    { 23500, 29855, 1317312 },
    { 23407, 29843, 1317312 },
    { 23402, 29796, 1317312 },
    { 23370, 29421, 1317184 },
    { 23359, 29090, 1317056 },
    { 23359, 28700, 1316672 },
    { 23359, 28309, 1316544 },
    { 23359, 27966, 1316288 },
    { 23359, 27574, 1316096 },
    { 23364, 27246, 1315904 },
    { 23365, 26862, 1315776 },
    { 23398, 26487, 1315072 },
    { 23507, 26129, 1313984 },
    { 23611, 25812, 1313280 },
    { 23665, 25439, 1312832 },
    { 23554, 25077, 1312896 },
    { 23354, 24778, 1311552 },
    { 23161, 24522, 1310336 },
    { 22913, 24234, 1310336 },
    { 22715, 23965, 1310336 },
    { 22507, 23637, 1310336 },
    { 22299, 23309, 1310336 },
    { 22117, 23023, 1310336 },
    { 21909, 22703, 1310336 },
    { 21701, 22380, 1310336 },
    { 21473, 22074, 1310336 },
    { 21257, 21821, 1310336 },
    { 21001, 21540, 1310336 },
    { 20729, 21268, 1310336 },
    { 20492, 21031, 1310208 },
    { 20259, 20794, 1308736 },
    { 20044, 20575, 1306944 },
    { 19848, 20393, 1305472 },
    { 19612, 20186, 1303616 },
    { 19372, 19986, 1301952 },
    { 19156, 19800, 1300224 },
    { 18939, 19582, 1298432 },
    { 18732, 19338, 1296832 },
    { 18542, 19148, 1295296 },
    { 18318, 18932, 1293440 },
    { 18090, 18713, 1291712 },
    { 17894, 18524, 1290176 },
    { 17666, 18305, 1288576 },
    { 17414, 18062, 1286464 },
    { 17218, 17873, 1284928 },
    { 16990, 17654, 1283072 },
    { 16755, 17429, 1281216 },
    { 16531, 17213, 1279424 },
    { 16335, 17020, 1277952 },
    { 16119, 16804, 1276288 },
    { 15903, 16588, 1274432 },
    { 15714, 16399, 1273024 },
    { 15494, 16179, 1271296 },
    { 15278, 15963, 1269440 },
    { 15026, 15711, 1268544 },
    { 14788, 15473, 1268416 },
    { 14556, 15241, 1266816 },
    { 14367, 15052, 1265280 },
    { 14132, 14817, 1263488 },
    { 13912, 14597, 1261760 },
    { 13712, 14397, 1260160 },
    { 13496, 14181, 1258432 },
    { 13280, 13965, 1256768 },
    { 13064, 13749, 1254976 },
    { 12844, 13529, 1253248 },
    { 12655, 13340, 1251648 },
    { 12439, 13124, 1249984 },
    { 12216, 12901, 1248256 },
    { 12027, 12712, 1246720 },
    { 11811, 12496, 1244992 },
    { 11622, 12307, 1243456 },
    { 11395, 12080, 1241728 },
    { 11179, 11864, 1239936 },
    { 10909, 11594, 1239296 },
    { 10680, 11365, 1237824 },
    { 10491, 11176, 1236288 },
    { 10257, 10942, 1234304 },
    { 10064, 10749, 1232832 },
    { 9840, 10525, 1231104 },
    { 9624, 10309, 1229440 },
    { 9435, 10120, 1227840 },
    { 9219, 9904, 1226176 },
    { 8999, 9684, 1224448 },
    { 8810, 9495, 1222848 },
    { 8594, 9279, 1221056 },
    { 8374, 9059, 1219456 },
    { 8185, 8870, 1217920 },
    { 7958, 8643, 1216064 },
    { 7742, 8427, 1214272 },
    { 7549, 8234, 1212800 },
    { 7333, 8018, 1211136 },
    { 7117, 7802, 1209280 },
    { 6880, 7565, 1208256 },
    { 6642, 7327, 1208256 },
    { 6370, 7055, 1208256 },
    { 6098, 6783, 1208256 },
    { 5860, 6545, 1208256 },
    { 5592, 6277, 1207936 },
    { 5329, 6014, 1206592 },
    { 5091, 5776, 1206464 },
    { 4819, 5504, 1206464 },
    { 4547, 5232, 1206464 },
    { 4309, 4994, 1206464 },
    { 4037, 4722, 1206720 },
    { 3766, 4451, 1206976 },
    { 3528, 4213, 1206912 },
    { 3256, 3941, 1206912 },
    { 2984, 3669, 1206912 },
    { 2746, 3431, 1206912 },
    { 2474, 3159, 1206912 },
    { 2202, 2887, 1206912 },
    { 2027, 2608, 1206912 },
    { 1858, 2267, 1206400 },
    { 1857, 2267, 1206400 },
    { 1821, 2179, 1206400 },
    { 1821, 2179, 1206400 },
    { 1821, 2179, 1206400 },
    { 1821, 2179, 1206400 }
}

local counter = 1

local step = 0;

local buffid = 0

--主循环
function Main(g_player)

    if step == 0 and "扬州" == map() then
        local nid = npc("名字:使役")
        if nid ~= 0 then
            moveto(xpos(nid))

            if xdis(nid) < 2 then
                counter = counter + 1

                if counter == 20 then
                    interact(nid)
                end

                if counter == 40 then
                    dialog("这就去")
                end

                if counter > 60 then
                    dialog("和平谷・五")
                end
            end
        end

        return
    end

    if step == 0 and "和平谷" == map() then
        local nid = npc("名字:嬴政")
        if nid ~= 0 then
            step = 1
            counter = 1

            if buff("骑御") then
                cast(54)
            end
        end
    end

    if step == 1 then
        local nid = npc("名字:嬴政")

        if nid ~= 0 then
            moveto(xpos(nid))
        end

        if xdis(nid) < 2 then
            step = 2
        end
        return
    end

    if step == 2 then

        if counter == 20 then
            interact(npc("名字:嬴政"))
        end

        if counter == 50 then
            dialog("")
        end

        if counter == 80 then
            dialog("接受任务")
        end

        if counter == 120 then
            interact(npc("名字:嬴政"))
        end

        if counter == 150 then
            dialog("看我给你演一个")
            dialog("看我给你演一个。")
        end

        counter = counter + 1

        local id = npc("模板ID:127064", "距离<8", "角度<45", "距离最近")
        if id ~= 0 then
            moveto(xpos(id))
        end

        local x, y, z = pos()
        if y > 29700 then
            step = 3
        end

        if buff("熊猫滚滚") then
            buffid = 28263
            local nid = npc("模板ID:127266", "距离<40", "角度<30", "距离最近")

            if nid ~= 0 then
                moveto(xpos(nid))
            else
                nid = npc("模板ID:126758", "距离<30", "角度<30", "距离最近")

                if nid > 0 then
                    local x_, y_, z_ = xpos(nid)
                    if y > y_ then
                        moveto(x_, y_, z_)
                    end
                end
            end


            if buffsn("速度") < 7 then
                cast(37436)
            end
        end

        if buffid == 28263 and nobuff("熊猫滚滚") then
            step = 3
        end
        return
    end

    if step == 3 then
        autoMove(task2)
        local nid = npc("名字:嬴政")
        if nid ~= 0 then
            if xdis(nid) < 4 then
                step = 4
                counter = 1
            end
        end
    end

    if step == 4 then
        local nid = npc("名字:嬴政")
        if counter == 50 then
            interact(nid)
        end

        if counter == 90 then
            dialog("")
        end
        counter = counter + 1
    end
end

